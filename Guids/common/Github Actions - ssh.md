### **Шаг 1: Генерация SSH-ключа (если у вас его ещё нет)**

1. Откройте терминал на вашем сервере (ssh admin@176.53.163.167).
2. Выполните команду для генерации SSH-ключа:

    ```bash
    ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
    ```

    - `-t rsa`: Указывает тип ключа (RSA).
    - `-b 4096`: Задаёт длину ключа (4096 бит).
    - `-C "your_email@example.com"`: Добавляет комментарий (обычно используется email).

3. Вам будет предложено указать путь для сохранения ключа. Нажмите `Enter`, чтобы сохранить ключ в папке `~/.ssh/` с именем по умолчанию (`id_rsa`).
   Если .ssh уже существует, можно сохранить в новую -

```
   /home/admin/.ssh/actions/id_rsa
```

4. Введите парольную фразу (passphrase) для защиты ключа. Это необязательно, но рекомендуется для повышения безопасности.

5. После выполнения команды будут созданы два файла:
    - **Приватный ключ**: `/home/admin/.ssh/actions/id_rsa`
    - **Публичный ключ**: `/home/admin/.ssh/actions/id_rsa.pub`

---

### **Шаг 2: Получение содержимого приватного SSH-ключа**

1. Откройте терминал.
2. Выполните команду, чтобы отобразить содержимое приватного ключа:

    ```bash
    cat ~/.ssh/actions/id_rsa
    ```

    - Это покажет содержимое файла `id_rsa`.

3. Скопируйте всё содержимое файла (от `-----BEGIN OPENSSH PRIVATE KEY-----` до `-----END OPENSSH PRIVATE KEY-----`).

---

### **Шаг 3: Добавление приватного SSH-ключа в секреты GitHub**

1. Перейдите в ваш репозиторий на GitHub.
2. Нажмите на вкладку **Settings** (Настройки) в верхней части страницы.
3. В левом боковом меню найдите раздел **Secrets and variables** (Секреты и переменные).
4. Нажмите на подраздел **Actions** (Действия).
5. Нажмите на кнопку **New repository secret** (Новый секрет репозитория).
6. В поле **Name** (Имя) введите `STAGING_SSH_PRIVATE_KEY`.
7. В поле **Value** (Значение) вставьте содержимое приватного SSH-ключа, которое вы скопировали на шаге 2.
8. Нажмите **Add secret** (Добавить секрет).

---

### **Шаг 4: Добавление публичного SSH-ключа на сервер**

1. Откройте терминал.
2. Выполните команду, чтобы отобразить содержимое публичного ключа:

    ```bash
    cat ~/.ssh/actions/id_rsa.pub
    ```

    - Это покажет содержимое файла `id_rsa.pub`.

3. Скопируйте всё содержимое файла (обычно это одна строка, начинающаяся с `ssh-rsa`).

4. Добавьте публичный ключ в файл `~/.ssh/authorized_keys` на сервере:

    ```bash
    echo "ваш_публичный_ключ" >> ~/.ssh/authorized_keys
    ```

    - Замените `ваш_публичный_ключ` на содержимое, которое вы скопировали.

5. Убедитесь, что права доступа к файлу `authorized_keys` корректны:
    ```bash
    chmod 600 ~/.ssh/authorized_keys
    chmod 700 ~/.ssh
    ```

---

### **Шаг 5: Использование секрета в GitHub Actions**

Теперь вы можете использовать секрет `STAGING_SSH_PRIVATE_KEY` в вашем workflow. Например:

```yaml
- name: SSH Command
  uses: D3rHase/ssh-command-action@v0.2.2
  with:
      host: ${{ secrets.STAGING_SSH_HOST }}
      user: ${{ secrets.STAGING_SSH_USERNAME }}
      private_key: ${{ secrets.STAGING_SSH_PRIVATE_KEY }}
      host_fingerprint: ${{ secrets.STAGING_SSH_FINGERPRINT }}
      command: source ~/.nvm/nvm.sh; ~/deploy.sh
```

---
