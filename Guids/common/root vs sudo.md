# Запрет подключения к root в командной строке сервера

Запрет подключения к **root** (суперпользователю) в командной строке сервера — это важная мера безопасности, которая помогает защитить систему от несанкционированного доступа и потенциальных угроз. Давайте разберем, почему это важно и как это можно сделать.

---

## Почему нужно запрещать подключение к root?

1. **Безопасность:**

    - Пользователь **root** имеет полный доступ ко всей системе, включая возможность изменять конфигурации, устанавливать или удалять программы, и выполнять любые команды.
    - Если злоумышленник получит доступ к root, он сможет полностью контролировать сервер, что может привести к утечке данных, установке вредоносного ПО или уничтожению системы.

2. **Ошибки администратора:**

    - Работа под root может привести к случайным ошибкам, таким как удаление важных файлов или изменение критических настроек.
    - Использование ограниченных учетных записей (например, с правами sudo) снижает риск таких ошибок.

3. **Соответствие стандартам безопасности:**
    - Многие стандарты безопасности (например, PCI DSS, GDPR) требуют ограничения доступа к root и использования учетных записей с минимально необходимыми привилегиями.

---

## Как запретить подключение к root?

#### 1. Отключение прямого входа в root через SSH

По умолчанию в большинстве современных дистрибутивов Linux (например, Ubuntu, CentOS) прямой вход в root через SSH уже отключен. Однако, если это не так, вы можете отключить его вручную:

1. Откройте файл конфигурации SSH:

```bash
   nano /etc/ssh/sshd_config
```

2. Найдите строку PermitRootLogin и измените её значение на no:

```bash
   PermitRootLogin no
```

3. Перезапустите службу SSH, чтобы изменения вступили в силу:

```bash
   systemctl restart sshd
```

Теперь прямой вход в root через SSH будет запрещен.

---

#### 2. Использование sudo

Вместо прямого входа в root рекомендуется использовать учетную запись с правами sudo. Это позволяет выполнять команды от имени root, но при этом сохраняет контроль над доступом.

1. Создайте пользователя с правами sudo (если он еще не создан):

```bash
   adduser username
   usermod -aG sudo username
```

2. Подключайтесь к серверу под этой учетной записью и используйте sudo для выполнения команд от имени root:

```bash
   sudo command
```

---

#### 3. Отключение root в консоли

Если вы хотите полностью запретить использование root, вы можете заблокировать учетную запись root:

1. Откройте терминал и выполните команду:

```bash
   passwd -l root
```

Эта команда заблокирует учетную запись root, сделав невозможным вход под root как через SSH, так и через консоль.

---

#### 4. Использование SELinux или AppArmor

Если вы используете дистрибутив Linux с поддержкой SELinux (например, CentOS) или AppArmor (например, Ubuntu), вы можете настроить политики безопасности, которые ограничивают доступ к root.

---

### Когда можно использовать root?

Использование root может быть оправдано в следующих случаях:

- **Аварийное восстановление системы:** Например, если нужно восстановить доступ к системе после сбоя.
- **Настройка сервера в изолированной среде:** Если сервер используется только в локальной сети без доступа извне.

Однако даже в таких случаях рекомендуется минимизировать использование root и переходить на учетные записи с ограниченными правами как можно быстрее.

---

### Итог

Запрет подключения к root — это важная мера безопасности, которая помогает защитить сервер от несанкционированного доступа и ошибок администратора. Рекомендуется использовать учетные записи с правами sudo и отключить прямой вход в root через SSH. Это соответствует лучшим практикам безопасности и снижает риски для системы.

---

# Почему доступ к root опаснее, чем доступ к пользователю с правами sudo?

Если злоумышленник может получить доступ к root, почему бы ему не получить доступ к другому пользователю и, используя sudo, сделать все, что он мог бы сделать через root?

Это хороший вопрос! Давайте разберем, почему доступ к **root** считается более опасным, чем доступ к пользователю с правами **sudo**, и почему злоумышленнику может быть сложнее использовать sudo для выполнения вредоносных действий.

---

## 1. Разница между root и sudo

- **Root:**

    - Пользователь **root** имеет **полный и неограниченный доступ** ко всей системе.
    - Он может выполнять **любые команды** без каких-либо ограничений.
    - Доступ к root не требует дополнительной аутентификации после входа в систему.

- **Sudo:**
    - Пользователь с правами **sudo** может выполнять команды от имени root, но **только после подтверждения пароля** (по умолчанию).
    - Права sudo могут быть **ограничены** с помощью файла /etc/sudoers, где администратор может разрешить или запретить выполнение определенных команд.
    - Sudo оставляет **логи всех выполненных команд**, что позволяет отслеживать действия пользователей.

---

## 2. Почему доступ к root опаснее?

Если злоумышленник получит доступ к **root**, он сразу получает **полный контроль** над системой. Это включает:

- Возможность устанавливать или удалять любое программное обеспечение.
- Возможность изменять конфигурации системы.
- Возможность скрывать свои действия, например, отключив логирование или удалив журналы.
- Возможность создавать новых пользователей с правами root или sudo.

В случае с **sudo**, злоумышленнику нужно:

1. Получить доступ к учетной записи пользователя с правами sudo.
2. Знать пароль этого пользователя (если sudo настроен с требованием пароля).
3. Выполнить команды через sudo, что оставит следы в логах (/var/log/auth.log или /var/log/secure).

---

## 3. Ограничение прав sudo

Администратор может настроить sudo так, чтобы пользователи могли выполнять только определенные команды. Например, в файле /etc/sudoers можно разрешить пользователю выполнять только команды, связанные с перезапуском сервисов, но запретить установку или удаление программ.

Пример настройки sudoers:
username ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart apache2
Это разрешает пользователю username перезапускать сервис Apache, но не позволяет выполнять другие команды от имени root.

---

## 4. Логирование действий sudo

Когда пользователь выполняет команду через sudo, она автоматически записывается в системные журналы. Это позволяет администратору отслеживать, кто и когда выполнял команды от имени root.

Пример записи в логах:

```bash
Oct 25 12:34:56 server sudo: username : TTY=pts/0 ; PWD=/home/username ; USER=root ; COMMAND=/usr/bin/systemctl restart apache2
```

Если злоумышленник использует sudo, его действия будут залогированы, и администратор сможет их проанализировать.

---

## 5. Дополнительные меры безопасности для sudo

- **Требование пароля:**
  По умолчанию sudo требует ввода пароля при выполнении команд. Это добавляет дополнительный уровень защиты.

- **Ограничение времени сессии:**
  Sudo может быть настроен так, чтобы требовать повторного ввода пароля через определенное время (например, 15 минут).

- **Запрет на выполнение опасных команд:**
  Администратор может запретить выполнение команд, которые могут нанести ущерб системе (например, rm, dd, chmod).

---

## 6. Почему злоумышленнику сложнее использовать sudo?

1. **Пароль:**

    - Если sudo настроен с требованием пароля, злоумышленнику нужно знать пароль пользователя.
    - Если пароль сложный и регулярно обновляется, это усложняет задачу.

2. **Ограниченные права:**

    - Если права sudo ограничены, злоумышленник не сможет выполнить все команды, которые мог бы выполнить root.

3. **Логирование:**

    - Все действия, выполненные через sudo, записываются в журналы. Это позволяет администратору отслеживать подозрительные действия.

4. **Дополнительные меры безопасности:**
    - Sudo может быть настроен с использованием двухфакторной аутентификации (2FA), что еще больше усложняет доступ.

---

### Итог

Доступ к **root** считается более опасным, так как он предоставляет **полный и неограниченный контроль** над системой. В то время как **sudo** позволяет выполнять команды от имени root, он добавляет дополнительные уровни защиты:

- Требование пароля.
- Ограничение прав.
- Логирование действий.
- Возможность настройки дополнительных мер безопасности.

Поэтому, даже если злоумышленник получит доступ к пользователю с правами sudo, ему будет сложнее выполнить вредоносные действия, чем если бы он имел доступ к root.
